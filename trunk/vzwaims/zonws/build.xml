<?xml version="1.0"?>

<project name="zonws" default="p"  basedir=".">

  <!-- USER'S DEFINED PATH IS PICKED FROM THIS PROPERTY FILE -->

	<property file="build.properties" />
    <property name="lib.dir" value="${basedir}/lib"/>
    <property name="build.dir" value="${basedir}/build"/>
    <property name="src.dir" value="${basedir}/src"/> 
    <property name="etc.dir" value="${basedir}/etc"/>
    <property name="deploy.dir" value="${tomcat.home}/webapps"/>
	<property name="app.name" value="zonws" />
	<property name="root.dir" value="${basedir}"/>
	<property name="build.dir" value="${root.dir}/build"/>
    <property name="src.dir" value="${root.dir}/src"/>	
	<import file="contextFile.xml"/>
	
    <!-- =================================================================== -->
    <!-- ============  ZONWS Class Path  =================================== -->
    <!-- =================================================================== -->
	
    <path id="classpath" >
        <fileset dir="${lib.dir}">
        </fileset>
        <pathelement location="${build.dir}/classes" />
    </path>

	<!-- =================================================================== -->
    <!-- =========  Clean - Build folder						    ======== -->
    <!-- =================================================================== -->
	
    <target name="clean.local">
        <delete dir="${build.dir}"/>    	
    </target>
	
	<!-- =================================================================== -->
	<!-- =============  Compile the web service  source   ================== -->
    <!-- =================================================================== -->
    
	 <target name="compile">
        <mkdir dir="${build.dir}/classes"/>
        <javac  destdir="${build.dir}/classes" debug="on" deprecation="on">
            <src path="${src.dir}"/>
            <classpath>
                <path refid="classpath"/>
            </classpath>
        </javac>
    </target>

	<!-- =================================================================== -->
    <!-- =========  Package - create a web service  war file   ======== -->
    <!-- =================================================================== -->
	
    <target name="package"  description="Create WAR"  depends="clean.local,compile">
        <war destfile="${build.dir}/${app.name}.war" webxml="${etc.dir}/web.xml">
        	<webinf dir="${etc.dir}" includes="ApplicationInfoService.wsdl"/>        	
            <webinf dir="${etc.dir}" includes="beans.xml"/>
        	<classes dir="${build.dir}/classes" />
        	<classes dir="${etc.dir}" includes="log4j.properties" />
        	<classes dir="${etc.dir}" includes="zonws.properties" />
            <lib dir="${lib.dir}"> </lib>
        </war>
    </target>

	<target name="p" depends="package"/>
			
		
    <!-- =================================================================== -->
    <!-- Cleans up the deployment on server ======================================= -->
    <!-- =================================================================== -->
    
    <target name="clean.server">
    	<delete dir="${tomcat.home}/webapps/zonws" quiet="true"/>
    	<delete file="${tomcat.home}/webapps/zonws.war" quiet="true"/>
    	<delete file="${tomcat.home}/conf/Catalina/localhost/zonws.xml" quiet="true"/>
    </target>
	
	<!-- =================================================================== -->
    <!-- Deploy Web service - Deploy to ant dir                              -->
    <!-- =================================================================== -->
    
    <target name="deploy" depends="clean.server,generateContextFile">
        <copy file="${build.dir}/${app.name}.war" todir="${deploy.dir}" />
    	<copy file="${build.dir}/zonws.xml" todir="${tomcat.home}/conf/Catalina/localhost" />
    	<copy file="${lib.dir}/ojdbc14.jar" todir="${tomcat.home}/lib" overwrite="true" />
    </target>

	<target name="d" depends="deploy" />
	
	<target name="all" depends="p,d" />
	
	
    <!-- =================================================================== -->
    <!-- Help - Ant Tasks                                                    -->
    <!-- =================================================================== -->

	<target name="help">
    	<echo message="  																			"/>
        <echo message=" *********************************************************************** 	"/>    	
        <echo message="                   ZONWS  Help Menu                    						"/>
        <echo message=" *********************************************************************** 	"/>
        <echo message="  clean.local	Cleans the Local build directory							"/>
        <echo message="  compile 		Compile the source 											"/>    	
        <echo message="  package		Packages a war file from build								"/>
		<echo message="  p	 			short cut for package										"/>
		<echo message="  clean.server	Cleans the Server deployment directory						"/>
		<echo message="  deploy   		Deploy a war file on server									"/>
		<echo message="  d	 			short cut for deploy										"/>
		<echo message="  all  			clean package and clean deploy								"/>
    	<echo message=" *********************************************************************** 	"/>
    </target>

</project>	